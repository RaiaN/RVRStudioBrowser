<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RVR Studio - 3D Photo Viewer</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Main 3D Canvas Container -->
    <div id="viewer-container"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="loader">
            <div class="loader-ring"></div>
            <span class="loader-text">Loading...</span>
        </div>
    </div>

    <!-- Top Header -->
    <header id="header">
        <h1>RVR Studio</h1>
        <span class="subtitle">3D Photo Viewer</span>
    </header>

    <!-- Control Panel -->
    <aside id="controls">
        <div class="control-group">
            <label for="depth-slider">Depth Intensity</label>
            <input type="range" id="depth-slider" min="0" max="100" value="30">
            <span id="depth-value">30%</span>
        </div>

        <div class="control-group">
            <label for="parallax-slider">Parallax Strength</label>
            <input type="range" id="parallax-slider" min="0" max="100" value="50">
            <span id="parallax-value">50%</span>
        </div>

        <div class="control-group">
            <label for="mesh-resolution">Mesh Resolution</label>
            <select id="mesh-resolution">
                <option value="64">Low (64)</option>
                <option value="128" selected>Medium (128)</option>
                <option value="256">High (256)</option>
                <option value="384">Ultra (384)</option>
            </select>
        </div>

        <div class="control-group">
            <label>
                <input type="checkbox" id="stereo-toggle">
                Stereoscopic View
            </label>
        </div>

        <div class="control-group">
            <label>
                <input type="checkbox" id="auto-dolly-toggle">
                Auto Camera Dolly
            </label>
        </div>

        <div class="control-group">
            <label>
                <input type="checkbox" id="wireframe-toggle">
                Show Wireframe
            </label>
        </div>

        <div class="control-group">
            <button id="reset-camera">Reset Camera</button>
        </div>

        <hr style="border-color: var(--border-color); margin: 8px 0;">

        <div class="control-group">
            <label for="render-mode">Render Mode</label>
            <select id="render-mode">
                <option value="multiLayer">Multi-Layer (3D mesh)</option>
                <option value="hybrid" selected>Parallax ‚≠ê (zero artifacts)</option>
            </select>
        </div>
        
        <div class="control-group" id="layer-count-group" style="display: none;">
            <label for="layer-count">Layer Count</label>
            <select id="layer-count">
                <option value="2" selected>2 Layers</option>
                <option value="3">3 Layers</option>
                <option value="4">4 Layers</option>
            </select>
        </div>
        
        <!-- Hybrid Mode Controls (Depth-Only Parallax) -->
        <div class="control-group hybrid-group" id="parallax-amount-group" style="display: none;">
            <label for="parallax-amount">Parallax Strength</label>
            <input type="range" id="parallax-amount" min="1" max="15" value="5">
            <span id="parallax-amount-value">5%</span>
        </div>
        
        <div class="control-group hybrid-group" id="debug-layers-group" style="display: none;">
            <label>
                <input type="checkbox" id="debug-layers-toggle">
                Show Depth Map
            </label>
        </div>
        
        <div class="control-group">
            <label for="debug-mode">Debug View</label>
            <select id="debug-mode">
                <option value="none" selected>Normal</option>
                <option value="depth">Depth Map</option>
                <option value="heatmap">Depth Heatmap</option>
                <option value="contours">Depth Contours</option>
                <option value="edges">Edge Detection (artifacts)</option>
                <option value="displacement">Displacement</option>
                <option value="wireframe">Wireframe</option>
            </select>
        </div>

        <div class="control-group">
            <button id="diagnose-btn">Diagnose Depth Map</button>
        </div>

        <hr style="border-color: var(--border-color); margin: 12px 0;">
        
        <!-- MESH MODE CONTROLS (BLADE-derived 3D meshes) -->
        <div class="control-group">
            <label>
                <input type="checkbox" id="mesh-mode-toggle">
                üé≠ 3D Mesh Mode (BLADE)
            </label>
        </div>
        
        <div id="mesh-controls-group" style="display: none;">
            <div class="control-group">
                <label for="mesh-lighting-preset">Lighting</label>
                <select id="mesh-lighting-preset">
                    <option value="studio" selected>Studio</option>
                    <option value="natural">Natural</option>
                    <option value="dramatic">Dramatic</option>
                    <option value="rim">Rim Light</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="mesh-display-mode">Display</label>
                <select id="mesh-display-mode">
                    <option value="textured" selected>Textured</option>
                    <option value="wireframe">Wireframe</option>
                    <option value="normal">Normals</option>
                    <option value="depth">Depth</option>
                    <option value="vertexColors">Vertex Colors</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="mesh-rim-light">Rim Light</label>
                <input type="range" id="mesh-rim-light" min="0" max="100" value="30">
                <span id="mesh-rim-light-value">30%</span>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="mesh-auto-rotate">
                    Auto Rotate
                </label>
            </div>
            
            <div class="control-group">
                <button id="mesh-stats-btn">Mesh Statistics</button>
            </div>
        </div>
    </aside>

    <!-- Diagnostics Panel -->
    <div id="diagnostics-panel" class="hidden">
        <h3>Depth Map Diagnostics</h3>
        <div id="diagnostics-content"></div>
        <button id="close-diagnostics">Close</button>
    </div>

    <!-- Mesh Statistics Panel -->
    <div id="mesh-stats-panel" class="hidden">
        <h3>üé≠ Mesh Statistics</h3>
        <div id="mesh-stats-content"></div>
        <button id="close-mesh-stats">Close</button>
    </div>

    <!-- Navigation Controls -->
    <nav id="navigation">
        <button id="prev-btn" class="nav-btn" title="Previous (‚Üê)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15,18 9,12 15,6"></polyline>
            </svg>
        </button>
        <div id="image-counter">
            <span id="current-index">1</span> / <span id="total-images">0</span>
        </div>
        <button id="next-btn" class="nav-btn" title="Next (‚Üí)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9,6 15,12 9,18"></polyline>
            </svg>
        </button>
    </nav>

    <!-- Image Thumbnails -->
    <div id="thumbnails"></div>

    <!-- Info Panel (depth under cursor) -->
    <div id="info-panel">
        <span id="depth-info">Depth: --</span>
    </div>

    <!-- Instructions -->
    <div id="instructions">
        <p>Move mouse to look around ‚Ä¢ Scroll to zoom ‚Ä¢ Arrow keys to navigate</p>
    </div>

    <!-- Three.js from CDN -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <!-- Application Scripts -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
